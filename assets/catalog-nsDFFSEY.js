import{c as M,d as S,e as C,a as R,b as y,s as B}from"./api-W8kOuucx.js";import{renderPagination as h,initPagination as x}from"./pagination-T5mrxBA8.js";import{Modal as u}from"./modal-hIj8PosX.js";import{handleSearchPageChange as I}from"./searchbar-C5fiM_f0.js";import"./vendor-B5Z-9nsW.js";const s={IMAGE_BASE_URL:"https://image.tmdb.org/t/p/w500",IMAGE_BASE_URL_2X:"https://image.tmdb.org/t/p/w780",BACKDROP_BASE_URL:"https://image.tmdb.org/t/p/w1280",BACKDROP_BASE_URL_2X:"https://image.tmdb.org/t/p/w1920",IMAGE_PLACEHOLDER:"src/images/no-poster.svg"};let r,g=null;const d={lastSearch:{input:"",year:"",isSearch:!1},genresCache:[]};function U(e){return e?e.split("-")[0]:"—"}function b(e){return e?(window.devicePixelRatio>1?s.IMAGE_BASE_URL_2X:s.IMAGE_BASE_URL)+e:s.IMAGE_PLACEHOLDER}function k(e){if(!e)return s.IMAGE_PLACEHOLDER;const t=s.IMAGE_BASE_URL.replace("/w500","/w300")+e,a=s.IMAGE_BASE_URL+e;return`${t} 1x, ${a} 2x`}function T(e){return e?(window.devicePixelRatio>1?s.BACKDROP_BASE_URL_2X:s.BACKDROP_BASE_URL)+e:s.IMAGE_PLACEHOLDER}function m(e){const t=document.createElement("div");t.className="error-message error",t.textContent=e,t.style.cssText="position:fixed;top:20px;right:20px;background:rgba(0,0,0,.9);color:#fff;padding:16px 24px;border-radius:12px;z-index:10000;box-shadow:0 8px 32px rgba(0,0,0,.5);",document.body.appendChild(t),setTimeout(()=>t.remove(),4e3)}function _(e,t){if(!t)return;const a=(e||0)/2,i=Math.floor(a),l=a-i>=.5,c=5-i-(l?1:0);let n="";for(let o=0;o<i;o++)n+='<svg class="catalog-icon catalog-icon-star"><use xlink:href="../images/symbol-defs.svg#icon-star"></use></svg>';l&&(n+='<svg class="catalog-icon catalog-icon-star-half"><use xlink:href="../images/symbol-defs.svg#icon-star-half"></use></svg>');for(let o=0;o<c;o++)n+='<svg class="catalog-icon catalog-icon-star-empty"><use xlink:href="../images/symbol-defs.svg#icon-star-empty"></use></svg>';t.innerHTML=n}function L(e){const t=document.getElementById("hero");if(!t||!r.heroContent)return;const a=e.backdrop_path?T(e.backdrop_path):b(e.poster_path),i=new Image;i.onload=function(){t.style.backgroundImage=`url('${a}')`,t.style.backgroundSize="cover",t.style.backgroundPosition="center",t.style.backgroundRepeat="no-repeat",t.style.backgroundAttachment="fixed",t.style.transition="background-image .3s ease"},i.src=a,r.heroContent.innerHTML=`
    <div class="hero-info">
      <h2 class="hero-title">${e.title}</h2>
      <div class="rating-stars" id="hero-rating-stars"></div>
      <p class="hero-overview">${e.overview||"No overview available."}</p>
      <div class="hero-actions">
        <button class="btn trailer-btn" data-id="${e.id}">Watch trailer</button>
        <button class="btn details-btn" data-id="${e.id}">More details</button>
      </div>
    </div>`,_(e.vote_average||0,document.getElementById("hero-rating-stars"))}function f(e){if(r.moviesUl.innerHTML="",!e||e.length===0){G();return}H();const t=document.createDocumentFragment();e.forEach(a=>t.appendChild(D(a))),r.moviesUl.appendChild(t)}function D(e){var c,n;const t=document.createElement("li");t.className="movie-card",t.dataset.id=e.id,t.style.cursor="pointer";let a="";(c=e.genres)!=null&&c.length?a=e.genres.map(o=>o.name).join(", "):(n=e.genre_ids)!=null&&n.length&&(a=e.genre_ids.map(A=>{var p;return((p=d.genresCache.find(w=>w.id===A))==null?void 0:p.name)||""}).filter(Boolean).slice(0,2).join(", "));const i=U(e.release_date),l=a?`${a} | ${i}`:i;return t.innerHTML=`
    <div class="movie-poster">
      <img src="${b(e.poster_path)}" alt="${e.title} poster"
           loading="lazy" srcset="${k(e.poster_path)}" />
    </div>
    <div class="movie-info">
      <div class="movie-info-left">
        <div class="movie-title">${e.title}</div>
        <div class="movie-meta">${l}</div>
      </div>
      <div class="movie-info-right">
        <div class="catalog-rating-stars"></div>
      </div>
    </div>`,_(e.vote_average||0,t.querySelector(".catalog-rating-stars")),t}window.renderMoviesList=f;window.renderPagination=h;async function v(e=1){var t;try{r.movieListRegion.setAttribute("aria-busy","true");const a=await C(e);if(r.heroContent&&e===1){const i=(t=a.results)==null?void 0:t[0];i&&L(i)}f(a.results||[]),h(e,a.total_pages||1),d.lastSearch={input:"",year:"",isSearch:!1}}catch(a){console.error("Error loading trending movies:",a),m("Failed to load trending movies. Please try again later.")}finally{r.movieListRegion.removeAttribute("aria-busy")}}async function P(e,t="",a=1){if(!e||e.trim()==="")return v();try{r.movieListRegion.setAttribute("aria-busy","true");const i=await B(e.trim(),a,t);f(i.results||[]),h(a,i.total_pages||1),d.lastSearch={input:e,year:t,isSearch:!0}}catch(i){console.error("Error performing search:",i),m("Search failed. Please try again.")}finally{r.movieListRegion.removeAttribute("aria-busy")}}async function $(e){if(await I(e)){window.scrollTo({top:0,behavior:"smooth"});return}d.lastSearch.isSearch?P(d.lastSearch.input,d.lastSearch.year,e):v(e),window.scrollTo({top:0,behavior:"smooth"})}function O(){g&&r.moviesUl.removeEventListener("click",g),g=async e=>{const t=e.target.closest(".movie-card");if(!t)return;const a=t.dataset.id;if(a)try{const i=await y(a);u.renderMovie(i)}catch(i){console.error("Modal open error:",i)}},r.moviesUl.addEventListener("click",g),document.addEventListener("click",async e=>{var i;const t=e.target.closest(".trailer-btn");if(t){const c=(i=(await R(t.dataset.id)).results)==null?void 0:i.find(n=>n.type==="Trailer"&&n.site==="YouTube");c?u.showTrailer(c.key):m("Trailer not available.");return}const a=e.target.closest(".details-btn");if(a){const l=await y(a.dataset.id);u.renderMovie(l)}})}async function E(){var e;try{r={moviesUl:document.getElementById("movies-ul"),heroContent:document.getElementById("hero-content"),movieListRegion:document.getElementById("movie-list"),emptyEl:document.getElementById("catalog-empty")},O(),x($);const t=await M();if(d.genresCache=t.genres||[],r.heroContent){const i=(e=(await S()).results)==null?void 0:e[0];i&&L(i)}await v(1)}catch(t){console.error("initialize error:",t),m("Failed to initialize application.")}}function G(){r.emptyEl&&(r.emptyEl.innerHTML=`
    <div class="l1">OOPS...</div>
    <div class="l1">We are very sorry!</div>
    <div class="l1">We don’t have any results matching your search.</div>`,r.emptyEl.classList.add("is-visible"),r.emptyEl.removeAttribute("hidden"))}function H(){r.emptyEl&&(r.emptyEl.classList.remove("is-visible"),r.emptyEl.setAttribute("hidden",""),r.emptyEl.innerHTML="")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E();
//# sourceMappingURL=catalog-nsDFFSEY.js.map
