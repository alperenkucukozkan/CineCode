{"version":3,"file":"library-BKAXE1tK.js","sources":["../../src/js/library.js"],"sourcesContent":["\nimport * as API from '../api/api.js';\nimport { Modal } from './modal.js';\n\n// ===== DOM =====\nconst hero           = document.getElementById('hero');\nconst titleEl        = document.getElementById('movie-title');\nconst overviewEl     = document.getElementById('movie-overview');\nconst ratingEl       = document.getElementById('movie-rating');\nconst heroButtons    = document.getElementById('hero-buttons');\nconst trailerBtn     = document.getElementById('trailer-btn');\nconst libraryListEl  = document.getElementById('library-list');\nconst emptyLibraryEl = document.getElementById('empty-library');\nconst genreFilter    = document.getElementById('genre-filter');\nconst loadMoreBtn    = document.getElementById('load-more-btn');\n// ===== STATE =====\nlet GENRES = {};                  \nlet currentLibraryView = [];     \nlet displayedCount = 0;\nconst LOAD_COUNT = 9;\n// ===== UTILS =====\nfunction createStarRating(vote) {\n  const rating = (Number(vote) || 0) / 2;\n  let stars = '';\n  for (let i = 1; i <= 5; i++) {\n    if (rating >= i) {\n      stars += `\n        <svg class=\"star-svg-full\" width=\"20\" height=\"20\">\n          <use xlink:href=\"./img/icon.svg#icon-full-star\"></use>\n        </svg>`;\n    } else if (rating >= i - 0.5) {\n      stars += `\n        <svg class=\"star-svg-half\" width=\"20\" height=\"20\" viewBox=\"0 0 32 32\">\n          <path fill=\"none\" stroke=\"#f87719\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"\n                stroke-miterlimit=\"4\" stroke-width=\"2\"\n                d=\"M30 13h-10.75l-3.25-10-3.25 10h-10.75l8.75 6-3.375 10 8.625-6.25 8.625 6.25-3.375-10 8.75-6z\"></path>\n          <path d=\"M16 3v19.75l-8.625 6.25 3.375-10-8.75-6h10.75l3.25-10z\" fill=\"#f87719\"></path>\n        </svg>`;\n    } else {\n      stars += `\n        <svg class=\"star-svg-empty\" width=\"20\" height=\"20\">\n          <use xlink:href=\"./img/icon.svg#icon-empty-star\"></use>\n        </svg>`;\n    }\n  }\n  return stars;\n}\nfunction getBrightness(rgb) {\n  const m = rgb.match(/\\d+/g);\n  if (!m) return 255;\n  const [r, g, b] = m.map(Number);\n  return (r * 299 + g * 587 + b * 114) / 1000;\n}\n// ===== HERO =====\nasync function initHero() {\n  try {\n    const dayData = await API.fetchDailyTrending(); // Eski fetch\n    const movie = dayData?.results?.[0];\n    if (!movie) return;\n\n    const bg = movie.backdrop_path || movie.poster_path || '';\n    hero.style.backgroundImage = `url(\"https://image.tmdb.org/t/p/original${bg}\")`;\n\n    titleEl.textContent    = movie.title || movie.name || '—';\n    overviewEl.textContent = movie.overview || 'No description available.';\n    ratingEl.innerHTML     = createStarRating(movie.vote_average);\n    heroButtons.classList.remove('hidden');\n\n    // Trailer butonu\n    trailerBtn.onclick = async () => {\n      try {\n        const vids = await API.fetchMovieVideos(movie.id);\n        const trailer = vids?.results?.find(v => v.type === 'Trailer' && v.site === 'YouTube');\n        if (trailer?.key) {\n          Modal.showTrailer(trailer.key);\n        } else {\n          alert('Trailer not available!');\n        }\n      } catch (e) {\n        console.error('Trailer fetch error:', e);\n      }\n    };\n\n    // İsteğe bağlı: hero tıklama ile modal açma\n    hero.addEventListener('click', async () => {\n      try {\n        const details = await API.fetchMovieDetails(movie.id);\n        Modal.renderMovie(details);\n      } catch (e) {\n        console.error('Hero modal error:', e);\n      }\n    });\n\n  } catch (e) {\n    console.error('Hero init error:', e);\n  }\n}\n\n// ===== LIBRARY RENDER =====\nfunction displayLibrary(movies, reset = true) {\n  if (reset) {\n    libraryListEl.innerHTML = '';\n    displayedCount = 0;\n    currentLibraryView = Array.isArray(movies) ? movies : [];\n  }\n  const batch = currentLibraryView.slice(displayedCount, displayedCount + LOAD_COUNT);\n  const html = batch.map(movie => {\n    if (!movie.poster_path) return '';\n    const year   = movie.release_date ? movie.release_date.slice(0, 4) : '—';\n    const genres = (movie.genre_ids || [])\n      .map(id => GENRES[id])\n      .filter(Boolean)\n      .join(', ') || '—';\n    const stars  = createStarRating(movie.vote_average);\n    return `\n      <li id=\"${movie.id}\" class=\"library-card\"\n          style=\"\n            background-image:url(https://image.tmdb.org/t/p/w500${movie.poster_path});\n            background-size:cover;background-position:center;\n            width:100%;max-width:395px;aspect-ratio:395/574;border-radius:12px;overflow:hidden;position:relative;\">\n        <div class=\"library-card-content\"\n             style=\"position:absolute;bottom:0;width:100%;\n                    background:linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));\n                    color:#fff;padding:10px;box-sizing:border-box;\">\n          <h3 style=\"margin:0;font-size:18px;\">${movie.title}</h3>\n          <p style=\"margin:2px 0;font-size:14px; color: #fff;\">${genres} | ${year}</p>\n          <div>${stars}</div>\n        </div>\n      </li>`;\n  }).join('');\n  libraryListEl.insertAdjacentHTML('beforeend', html);\n  displayedCount += batch.length;\n  if (displayedCount < currentLibraryView.length) {\n    loadMoreBtn.classList.remove('hidden');\n  } else {\n    loadMoreBtn.classList.add('hidden');\n  }\n  attachCardClickEvents();\n}\nfunction loadLibrary() {\n  const library = JSON.parse(localStorage.getItem('library')) || [];\n  if (!library.length) {\n    emptyLibraryEl.style.display = 'flex';\n    libraryListEl.innerHTML = '';\n    genreFilter?.parentElement && (genreFilter.parentElement.style.display = 'none');\n    loadMoreBtn?.classList.add('hidden');\n    return;\n  }\n  emptyLibraryEl.style.display = 'none';\n  genreFilter?.parentElement && (genreFilter.parentElement.style.display = 'flex');\n\n  const set = new Set();\n  library.forEach(m => (m.genre_ids || []).forEach(id => GENRES[id] && set.add(GENRES[id])));\n  if (genreFilter) {\n    genreFilter.innerHTML = `<option value=\"all\">Genre</option>` +\n      [...set].map(n => `<option value=\"${n}\">${n}</option>`).join('');\n  }\n  displayLibrary(library);\n}\nfunction attachCardClickEvents() {\n  document.querySelectorAll('.library-card').forEach(card => {\n    card.removeEventListener('click', card._clickHandler);\n    const handler = () => {\n      const id = Number(card.id);\n      const library = JSON.parse(localStorage.getItem('library')) || [];\n      const movie = library.find(m => Number(m.id) === id);\n      if (movie) Modal.renderMovie(movie);\n    };\n    card._clickHandler = handler;\n    card.addEventListener('click', handler);\n  });\n}\n\ndocument.addEventListener('click', e => {\n  if (e.target?.matches?.('[data-action=\"toggle-library\"]')) {\n    setTimeout(() => loadLibrary(), 0);\n  }\n});\n// ===== EVENTS =====\nloadMoreBtn?.addEventListener('click', () => displayLibrary(currentLibraryView, false));\ngenreFilter?.addEventListener('change', e => {\n  const value = e.target.value;\n  const all = JSON.parse(localStorage.getItem('library')) || [];\n  if (value === 'all') return displayLibrary(all);\n  const filtered = all.filter(m => (m.genre_ids || []).some(id => GENRES[id] === value));\n  displayLibrary(filtered);\n});\n\n(function styleSelectByTheme() {\n  if (!genreFilter) return;\n  const bodyBg = window.getComputedStyle(document.body).backgroundColor;\n  const brightness = getBrightness(bodyBg);\n  const textColor = brightness < 128 ? '#fff' : '#000';\n  genreFilter.style.backgroundColor = bodyBg;\n  genreFilter.style.color = textColor;\n  genreFilter.style.border = `1px solid ${brightness < 128 ? '#000' : '#fff'}`;\n})();\n// ===== INIT =====\n(async function init() {\n  try {\n\n    const genresRes = await API.fetchGenres(); // { genres: [{id,name},...] }\n    const list = genresRes?.genres || [];\n    GENRES = list.reduce((acc, g) => ((acc[g.id] = g.name), acc), {});\n\n    await initHero();\n\n    loadLibrary();\n  } catch (err) {\n    console.error('Library init error:', err);\n  }\n})();"],"names":["hero","titleEl","overviewEl","ratingEl","heroButtons","trailerBtn","libraryListEl","emptyLibraryEl","genreFilter","loadMoreBtn","GENRES","currentLibraryView","displayedCount","LOAD_COUNT","createStarRating","vote","rating","stars","getBrightness","rgb","m","r","g","b","initHero","dayData","API.fetchDailyTrending","movie","_a","bg","vids","API.fetchMovieVideos","trailer","v","Modal","e","details","API.fetchMovieDetails","displayLibrary","movies","reset","batch","html","year","genres","id","attachCardClickEvents","loadLibrary","library","set","n","card","handler","_b","value","all","filtered","bodyBg","brightness","textColor","genresRes","API.fetchGenres","acc","err"],"mappings":"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"}