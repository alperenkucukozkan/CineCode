{"version":3,"file":"library-Dn0V8E9h.js","sources":["../../src/js/library.js"],"sourcesContent":["import * as API from '../api/api.js';\nimport { Modal } from './modal.js';\n\n\n// ===== DOM =====\nconst libraryListEl  = document.getElementById('library-list');\nconst emptyLibraryEl = document.getElementById('empty-library');\nconst genreFilter    = document.getElementById('genre-filter');\nconst loadMoreBtn    = document.getElementById('load-more-btn');\n\n// ===== STATE =====\nlet GENRES = {};                  \nlet currentLibraryView = [];     \nlet displayedCount = 0;\nconst LOAD_COUNT = 9;\n\n// ===== UTILS =====\nfunction createStarRating(vote) {\n  const rating = (Number(vote) || 0) / 2;\n  let stars = '';\n  for (let i = 1; i <= 5; i++) {\n    if (rating >= i) {\n      stars += `\n        <svg class=\"star-svg-full\" width=\"20\" height=\"20\">\n          <use xlink:href=\"./img/icon.svg#icon-full-star\"></use>\n        </svg>`;\n    } else if (rating >= i - 0.5) {\n      stars += `\n        <svg class=\"star-svg-half\" width=\"20\" height=\"20\" viewBox=\"0 0 32 32\">\n          <path fill=\"none\" stroke=\"#f87719\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"\n                stroke-miterlimit=\"4\" stroke-width=\"2\"\n                d=\"M30 13h-10.75l-3.25-10-3.25 10h-10.75l8.75 6-3.375 10 8.625-6.25 8.625 6.25-3.375-10 8.75-6z\"></path>\n          <path d=\"M16 3v19.75l-8.625 6.25 3.375-10-8.75-6h10.75l3.25-10z\" fill=\"#f87719\"></path>\n        </svg>`;\n    } else {\n      stars += `\n        <svg class=\"star-svg-empty\" width=\"20\" height=\"20\">\n          <use xlink:href=\"./img/icon.svg#icon-empty-star\"></use>\n        </svg>`;\n    }\n  }\n  return stars;\n}\n\nfunction getBrightness(rgb) {\n  const m = rgb.match(/\\d+/g);\n  if (!m) return 255;\n  const [r, g, b] = m.map(Number);\n  return (r * 299 + g * 587 + b * 114) / 1000;\n}\n\n// ===== LIBRARY RENDER =====\nfunction displayLibrary(movies, reset = true) {\n  if (reset) {\n    libraryListEl.innerHTML = '';\n    displayedCount = 0;\n    currentLibraryView = Array.isArray(movies) ? movies : [];\n  }\n\n  const batch = currentLibraryView.slice(displayedCount, displayedCount + LOAD_COUNT);\n  const html = batch.map(movie => {\n    if (!movie.poster_path) return '';\n    const year   = movie.release_date ? movie.release_date.slice(0, 4) : '—';\n    const genres = (movie.genre_ids || [])\n      .map(id => GENRES[id])\n      .filter(Boolean)\n      .join(', ') || '—';\n    const stars  = createStarRating(movie.vote_average);\n\n    return `\n      <li id=\"${movie.id}\" class=\"library-card\"\n          style=\"\n            background-image:url(https://image.tmdb.org/t/p/w500${movie.poster_path});\n            background-size:cover;background-position:center;\n            width:100%;max-width:395px;aspect-ratio:395/574;border-radius:12px;overflow:hidden;position:relative;\">\n        <div class=\"library-card-content\"\n             style=\"position:absolute;bottom:0;width:100%;\n                    background:linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));\n                    color:#fff;padding:10px;box-sizing:border-box;\">\n          <h3 style=\"margin:0;font-size:18px;\">${movie.title}</h3>\n          <p style=\"margin:2px 0;font-size:14px; color: #fff;\">${genres} | ${year}</p>\n          <div>${stars}</div>\n        </div>\n      </li>`;\n  }).join('');\n\n  libraryListEl.insertAdjacentHTML('beforeend', html);\n  displayedCount += batch.length;\n\n  if (displayedCount < currentLibraryView.length) {\n    loadMoreBtn.classList.remove('hidden');\n  } else {\n    loadMoreBtn.classList.add('hidden');\n  }\n\n  attachCardClickEvents();\n}\n\nfunction loadLibrary() {\n  const library = JSON.parse(localStorage.getItem('library')) || [];\n  if (!library.length) {\n    emptyLibraryEl.style.display = 'flex';\n    libraryListEl.innerHTML = '';\n    genreFilter?.parentElement && (genreFilter.parentElement.style.display = 'none');\n    loadMoreBtn?.classList.add('hidden');\n    return;\n  }\n\n  emptyLibraryEl.style.display = 'none';\n  genreFilter?.parentElement && (genreFilter.parentElement.style.display = 'flex');\n\n  const set = new Set();\n  library.forEach(m => (m.genre_ids || []).forEach(id => GENRES[id] && set.add(GENRES[id])));\n\n  if (genreFilter) {\n    genreFilter.innerHTML = `<option value=\"all\">Genre</option>` +\n      [...set].map(n => `<option value=\"${n}\">${n}</option>`).join('');\n  }\n\n  displayLibrary(library);\n}\n\nfunction attachCardClickEvents() {\n  document.querySelectorAll('.library-card').forEach(card => {\n    card.removeEventListener('click', card._clickHandler);\n    const handler = () => {\n      const id = Number(card.id);\n      const library = JSON.parse(localStorage.getItem('library')) || [];\n      const movie = library.find(m => Number(m.id) === id);\n      if (movie) Modal.renderMovie(movie);\n    };\n    card._clickHandler = handler;\n    card.addEventListener('click', handler);\n  });\n}\n\ndocument.addEventListener('click', e => {\n  if (e.target?.matches?.('[data-action=\"toggle-library\"]')) {\n    setTimeout(() => loadLibrary(), 0);\n  }\n});\n\n// ===== EVENTS =====\nloadMoreBtn?.addEventListener('click', () => displayLibrary(currentLibraryView, false));\ngenreFilter?.addEventListener('change', e => {\n  const value = e.target.value;\n  const all = JSON.parse(localStorage.getItem('library')) || [];\n  if (value === 'all') return displayLibrary(all);\n  const filtered = all.filter(m => (m.genre_ids || []).some(id => GENRES[id] === value));\n  displayLibrary(filtered);\n});\n\n(function styleSelectByTheme() {\n  if (!genreFilter) return;\n  const bodyBg = window.getComputedStyle(document.body).backgroundColor;\n  const brightness = getBrightness(bodyBg);\n  const textColor = brightness < 128 ? '#fff' : '#000';\n  genreFilter.style.backgroundColor = bodyBg;\n  genreFilter.style.color = textColor;\n  genreFilter.style.border = `1px solid ${brightness < 128 ? '#fff' : '#000'}`;\n})();\n\n// ===== INIT =====\n(async function init() {\n  try {\n    const genresRes = await API.fetchGenres();\n    const list = genresRes?.genres || [];\n    GENRES = list.reduce((acc, g) => ((acc[g.id] = g.name), acc), {});\n\n    loadLibrary();\n  } catch (err) {\n    console.error('Library init error:', err);\n  }\n})();\n"],"names":["libraryListEl","emptyLibraryEl","genreFilter","loadMoreBtn","GENRES","currentLibraryView","displayedCount","LOAD_COUNT","createStarRating","vote","rating","stars","i","getBrightness","rgb","m","r","g","b","displayLibrary","movies","reset","batch","html","movie","year","genres","id","attachCardClickEvents","loadLibrary","library","set","n","card","handler","Modal","e","_b","_a","value","all","filtered","bodyBg","brightness","textColor","genresRes","API.fetchGenres","acc","err"],"mappings":"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"}