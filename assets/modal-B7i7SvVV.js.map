{"version":3,"file":"modal-B7i7SvVV.js","sources":["../../src/js/modal.js"],"sourcesContent":["import * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\n\n/* ----- küçük “library” yardımcıları ----- */\nfunction readLibrary() {\n  try {\n    return JSON.parse(localStorage.getItem('library')) || [];\n  } catch {\n    return [];\n  }\n}\nfunction writeLibrary(arr) {\n  localStorage.setItem('library', JSON.stringify(arr));\n}\nfunction isInLibrary(movieId) {\n  const lib = readLibrary();\n  return lib.some(m => Number(m.id) === Number(movieId));\n}\nfunction toggleLibrary(movie, btn) {\n  let lib = readLibrary();\n  const exists = lib.some(m => Number(m.id) === Number(movie.id));\n  if (exists) {\n    lib = lib.filter(m => Number(m.id) !== Number(movie.id));\n    btn.textContent = 'Add to Library';\n    btn.classList.remove('app-btn--danger');\n    btn.classList.add('app-btn--primary');\n  } else {\n    if (!movie.genre_ids && movie.genres) {\n      movie.genre_ids = movie.genres.map(g => g.id);\n    }\n    lib.push(movie);\n    btn.textContent = 'Remove from my library';\n    btn.classList.remove('app-btn--primary');\n    btn.classList.add('app-btn--danger');\n  }\n  writeLibrary(lib);\n}\n\n/* ----- tekil basicLightbox instance ----- */\nlet instance = null;\n\nfunction openWithHTML(html, onShow) {\n  if (instance?.visible()) instance.close();\n  instance = basicLightbox.create(html, {\n    onShow: inst => {\n      const closeBtn = inst.element().querySelector('.app-modal__close');\n      if (closeBtn) closeBtn.addEventListener('click', () => inst.close());\n\n      // ✅ ESC ile kapatma event'i\n      function escHandler(e) {\n        if (e.key === 'Escape') {\n          inst.close();\n          document.removeEventListener('keydown', escHandler);\n        }\n      }\n      document.addEventListener('keydown', escHandler);\n\n      if (typeof onShow === 'function') onShow(inst);\n    },\n  });\n  instance.show();\n}\n\n/* ----- film layout ----- */\nfunction movieHTML(movie) {\n  const posterUrl = movie.poster_path\n    ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`\n    : `https://via.placeholder.com/500x750?text=No+Image`;\n\n  const genres = Array.isArray(movie.genres)\n    ? movie.genres.map(g => g.name).join(', ')\n    : Array.isArray(movie.genre_ids)\n    ? movie.genre_ids.join(', ')\n    : '-';\n\n  const inLib = isInLibrary(movie.id);\n\n  return `\n    <div class=\"app-modal\" role=\"dialog\" aria-modal=\"true\">\n      <button class=\"app-modal__close\" type=\"button\" aria-label=\"Close\">\n        <svg class=\"app-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 12 12\">\n          <path d=\"M11 11L0.5 0.5M11 0.5L0.5 11\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n      </button>\n      <img src=\"${posterUrl}\" class=\"app-modal__poster\" alt=\"${\n    movie.title || movie.name || 'Movie'\n  }\"/>\n      <div class=\"app-modal__details\">\n        <h2 class=\"app-modal__title\">${\n          movie.title || movie.name || 'Untitled'\n        }</h2>\n        <div class=\"app-meta\">\n          <div><strong>Vote / Votes:</strong> \n            <span class=\"vote-box\">${(movie.vote_average ?? 0).toFixed(\n              1\n            )}</span> \n            <span>/</span> \n            <span class=\"vote-box\">${movie.vote_count ?? 0}</span>\n          </div>\n          <div><strong>Popularity:</strong> ${(movie.popularity ?? 0).toFixed(\n            1\n          )}</div>\n          <div><strong>Genre:</strong> ${genres}</div>\n        </div>\n        <h3 class=\"app-section-title\">ABOUT</h3>\n        <p class=\"app-modal__about\">${\n          movie.overview || 'No description available.'\n        }</p>\n        <button class=\"app-btn ${\n          inLib ? 'app-btn--danger' : 'app-btn--primary'\n        }\" data-action=\"toggle-library\">\n          ${inLib ? 'Remove from my library' : 'Add to Library'}\n        </button>\n      </div>\n    </div>\n  `;\n}\n\n/* ----- public API ----- */\nexport const Modal = {\n  renderMovie(movie) {\n    openWithHTML(movieHTML(movie), inst => {\n      const btn = inst\n        .element()\n        .querySelector('[data-action=\"toggle-library\"]');\n      if (btn) btn.addEventListener('click', () => toggleLibrary(movie, btn));\n    });\n  },\n  showTrailer(youtubeKey) {\n    openWithHTML(`\n      <div class=\"app-modal app-modal--wide\">\n        <button class=\"app-modal__close\" type=\"button\" aria-label=\"Close\">\n          <svg class=\"app-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 12 12\">\n            <path d=\"M11 11L0.5 0.5M11 0.5L0.5 11\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </button>\n        <div class=\"app-modal__player\">\n          <iframe\n            src=\"https://www.youtube.com/embed/${youtubeKey}\"\n            width=\"100%\" height=\"100%\" frameborder=\"0\" allowfullscreen\n            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\">\n          </iframe>\n        </div>\n      </div>\n    `);\n  },\n  showMessage(text, title = 'Info') {\n    openWithHTML(`\n      <div class=\"app-modal\">\n        <button class=\"app-modal__close\" type=\"button\" aria-label=\"Close\">\n          <svg class=\"app-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 12 12\">\n            <path d=\"M11 11L0.5 0.5M11 0.5L0.5 11\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </button>\n        <div class=\"app-modal__details\">\n          <h2 class=\"app-modal__title\">${title}</h2>\n          <p class=\"app-modal__about\">${text}</p>\n        </div>\n      </div>\n    `);\n  },\n  openWithHTML,\n  close() {\n    if (instance?.visible()) instance.close();\n  },\n};\n"],"names":["readLibrary","writeLibrary","arr","isInLibrary","movieId","m","toggleLibrary","movie","btn","lib","g","instance","openWithHTML","html","onShow","basicLightbox.create","inst","closeBtn","escHandler","e","movieHTML","posterUrl","genres","inLib","Modal","youtubeKey","text","title"],"mappings":"yCAIA,SAASA,GAAc,CACrB,GAAI,CACF,OAAO,KAAK,MAAM,aAAa,QAAQ,SAAS,CAAC,GAAK,EAC1D,MAAU,CACN,MAAO,EACR,CACH,CACA,SAASC,EAAaC,EAAK,CACzB,aAAa,QAAQ,UAAW,KAAK,UAAUA,CAAG,CAAC,CACrD,CACA,SAASC,EAAYC,EAAS,CAE5B,OADYJ,IACD,KAAKK,GAAK,OAAOA,EAAE,EAAE,IAAM,OAAOD,CAAO,CAAC,CACvD,CACA,SAASE,EAAcC,EAAOC,EAAK,CACjC,IAAIC,EAAMT,IACKS,EAAI,KAAKJ,GAAK,OAAOA,EAAE,EAAE,IAAM,OAAOE,EAAM,EAAE,CAAC,GAE5DE,EAAMA,EAAI,OAAOJ,GAAK,OAAOA,EAAE,EAAE,IAAM,OAAOE,EAAM,EAAE,CAAC,EACvDC,EAAI,YAAc,iBAClBA,EAAI,UAAU,OAAO,iBAAiB,EACtCA,EAAI,UAAU,IAAI,kBAAkB,IAEhC,CAACD,EAAM,WAAaA,EAAM,SAC5BA,EAAM,UAAYA,EAAM,OAAO,IAAIG,GAAKA,EAAE,EAAE,GAE9CD,EAAI,KAAKF,CAAK,EACdC,EAAI,YAAc,yBAClBA,EAAI,UAAU,OAAO,kBAAkB,EACvCA,EAAI,UAAU,IAAI,iBAAiB,GAErCP,EAAaQ,CAAG,CAClB,CAGA,IAAIE,EAAW,KAEf,SAASC,EAAaC,EAAMC,EAAQ,CAC9BH,GAAA,MAAAA,EAAU,WAAWA,EAAS,MAAK,EACvCA,EAAWI,EAAoB,OAACF,EAAM,CACpC,OAAQG,GAAQ,CACd,MAAMC,EAAWD,EAAK,QAAS,EAAC,cAAc,mBAAmB,EAC7DC,GAAUA,EAAS,iBAAiB,QAAS,IAAMD,EAAK,MAAK,CAAE,EAGnE,SAASE,EAAWC,EAAG,CACjBA,EAAE,MAAQ,WACZH,EAAK,MAAK,EACV,SAAS,oBAAoB,UAAWE,CAAU,EAErD,CACD,SAAS,iBAAiB,UAAWA,CAAU,EAE3C,OAAOJ,GAAW,YAAYA,EAAOE,CAAI,CAC9C,CACL,CAAG,EACDL,EAAS,KAAI,CACf,CAGA,SAASS,EAAUb,EAAO,CACxB,MAAMc,EAAYd,EAAM,YACpB,kCAAkCA,EAAM,WAAW,GACnD,oDAEEe,EAAS,MAAM,QAAQf,EAAM,MAAM,EACrCA,EAAM,OAAO,IAAIG,GAAKA,EAAE,IAAI,EAAE,KAAK,IAAI,EACvC,MAAM,QAAQH,EAAM,SAAS,EAC7BA,EAAM,UAAU,KAAK,IAAI,EACzB,IAEEgB,EAAQpB,EAAYI,EAAM,EAAE,EAElC,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAOSc,CAAS,oCACvBd,EAAM,OAASA,EAAM,MAAQ,OAC9B;AAAA;AAAA,uCAGOA,EAAM,OAASA,EAAM,MAAQ,UAC9B;AAAA;AAAA;AAAA,sCAG6BA,EAAM,cAAgB,GAAG,QACjD,CACd,CAAa;AAAA;AAAA,qCAEwBA,EAAM,YAAc,CAAC;AAAA;AAAA,+CAEXA,EAAM,YAAc,GAAG,QAC1D,CACZ,CAAW;AAAA,yCAC8Be,CAAM;AAAA;AAAA;AAAA,sCAIrCf,EAAM,UAAY,2BACnB;AAAA,iCAECgB,EAAQ,kBAAoB,kBAC7B;AAAA,YACGA,EAAQ,yBAA2B,gBAAgB;AAAA;AAAA;AAAA;AAAA,GAK/D,CAGY,MAACC,EAAQ,CACnB,YAAYjB,EAAO,CACjBK,EAAaQ,EAAUb,CAAK,EAAGS,GAAQ,CACrC,MAAMR,EAAMQ,EACT,QAAS,EACT,cAAc,gCAAgC,EAC7CR,GAAKA,EAAI,iBAAiB,QAAS,IAAMF,EAAcC,EAAOC,CAAG,CAAC,CAC5E,CAAK,CACF,EACD,YAAYiB,EAAY,CACtBb,EAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDASgCa,CAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMtD,CACF,EACD,YAAYC,EAAMC,EAAQ,OAAQ,CAChCf,EAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAQwBe,CAAK;AAAA,wCACND,CAAI;AAAA;AAAA;AAAA,KAGvC,CACF,EACD,aAAAd,EACA,OAAQ,CACFD,GAAA,MAAAA,EAAU,WAAWA,EAAS,MAAK,CACxC,CACH"}