{"version":3,"file":"modal-S3JN022D.js","sources":["../../src/js/modal.js"],"sourcesContent":["// API'den film detaylarını alma\nimport { fetchMovieDetails } from '../api/api.js';\n\n// Local Storage için kullanılacak anahtar ismi\nconst LOCAL_STORAGE_KEY = 'myLibraryMovies_v1';\n\n// TMDB API'den gelen görsellerin temel URL'si\nconst IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';\n\n// Oy veya popülerlik değerlerini yuvarlama fonk\nconst roundOneDecimal = value => {\n  const n = Number(value);\n  if (Number.isNaN(n)) return 0.0;\n  return Math.round(n * 10) / 10;\n};\n\n// Local Storage'dan kayıtlı veriyi okuma fonk\nconst readLibraryFromStorage = () => {\n  try {\n    const raw = localStorage.getItem(LOCAL_STORAGE_KEY);\n    if (!raw) return {}; // Eğer veri yoksa boş obje döner\n    return JSON.parse(raw);\n  } catch (error) {\n    console.error('Local Storage okuma hatası:', error);\n    return {};\n  }\n};\n\n// Local Storage'a yeni film ekleme fonk\nconst writeLibraryToStorage = obj => {\n  try {\n    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(obj));\n  } catch (error) {\n    console.error('Local Storage ekleme hatası:', error);\n  }\n};\n\n// Bir film kütüphanede var mı kontrol eden fonk (id üzerinden)\nconst isInLibrary = movieId => {\n  const lib = readLibraryFromStorage();\n  return Boolean(lib[movieId]);\n};\n\n// Yeni bir filmi kütüphaneye ekleme fonk\nconst addToLibrary = movieObj => {\n  if (!movieObj || !movieObj.id) return;\n  const lib = readLibraryFromStorage();\n  lib[movieObj.id] = movieObj;\n  writeLibraryToStorage(lib);\n};\n\n// filmi kütüphaneden kaldırma fonk\nconst removeFromLibrary = movieId => {\n  const lib = readLibraryFromStorage();\n  if (lib[movieId]) {\n    delete lib[movieId];\n    writeLibraryToStorage(lib);\n  }\n};\n\n// Film posteri için URL oluşturma\nconst buildImageUrl = path => {\n  if (!path) return '';\n  return `${IMAGE_BASE}${path}`;\n};\n\n// DOM ELEMANLARINI SEÇME\n\nconst modalEl = document.querySelector('.modal');\nconst closeBtnEl = document.querySelector('.close-icon');\nconst posterImgEl = document.querySelector('.modal-img');\nconst titleEl = document.querySelector('.movie-title');\nconst votesPuanEl = document.querySelector('.votes-puanlama');\nconst votesCountEl = document.querySelector('.votes-oysayisi');\nconst popularityEl = document.querySelector('.popularity-value');\nconst genreEl = document.querySelector('.genre-value');\nconst aboutEl = document.querySelector('.about-value');\nconst libraryBtn = document.querySelector('.modal-add-button');\n\n//  Modal Aç/Kapat İşlemleri\n\nlet escHandler = null;\nlet backdropHandler = null;\nlet currentMovieData = null; // Şu anda açık olan filmin detayları\n\n// Modal açma fonksiyonu\nexport const openModal = () => {\n  if (!modalEl) return;\n  modalEl.classList.add('is-open');\n  modalEl.setAttribute('aria-hidden', 'false');\n\n  // ESC tuşuna basıldığında modal kapansın\n  escHandler = e => {\n    if (e.key === 'Escape') {\n      closeModal();\n    }\n  };\n  document.addEventListener('keydown', escHandler);\n\n  // modal dışında bir yere tıklanırsa modal kapansın\n  backdropHandler = e => {\n    if (e.target === modalEl) {\n      closeModal();\n    }\n  };\n  modalEl.addEventListener('click', backdropHandler);\n};\n\n// Modal kapama fonk\nexport const closeModal = () => {\n  if (!modalEl) return;\n  modalEl.classList.remove('is-open');\n  modalEl.setAttribute('aria-hidden', 'true');\n  currentMovieData = null;\n\n  // ESC ve tıklama eventlerini temizleme\n  if (escHandler) document.removeEventListener('keydown', escHandler);\n  if (backdropHandler) modalEl.removeEventListener('click', backdropHandler);\n};\n\n// Kapatma ikonuna tıklanırsa modal kapanır\nif (closeBtnEl) {\n  closeBtnEl.addEventListener('click', e => {\n    e.stopPropagation();\n    closeModal();\n  });\n}\n\n// --------------------Modal İçeriğini Güncelleme-------------------\n\n// Kütüphaneye ekleme/kaldırma butonunun metnini güncelleme\nconst updateLibraryButton = movieId => {\n  if (!libraryBtn) return;\n  const inLib = isInLibrary(movieId);\n  libraryBtn.textContent = inLib\n    ? 'Remove from my Library'\n    : 'Add to my Library';\n  libraryBtn.dataset.inLibrary = inLib ? 'true' : 'false';\n  libraryBtn.dataset.movieId = movieId;\n};\n\n// Ana render fonksiyonu — film bilgilerini modal içine yerleştirme\nexport const renderMovieInModal = movie => {\n  if (!movie) return;\n  currentMovieData = movie;\n\n  // Poster alanı\n  const posterPath = movie.poster_path || movie.backdrop_path || '';\n  const posterUrl = buildImageUrl(posterPath);\n  if (posterImgEl) {\n    if (posterUrl) {\n      posterImgEl.src = posterUrl;\n      posterImgEl.alt = movie.title || movie.name || 'Movie Poster';\n    } else {\n      posterImgEl.src = '';\n      posterImgEl.alt = 'Poster not available';\n    }\n  }\n\n  //  Film başlığı\n  if (titleEl) titleEl.textContent = movie.title || movie.name || 'No title';\n\n  //  Oy ortalaması\n  if (votesPuanEl) {\n    const rounded = roundOneDecimal(movie.vote_average ?? 0);\n    votesPuanEl.textContent = rounded.toFixed(1);\n  }\n\n  //  Toplam oy sayısı\n  if (votesCountEl) votesCountEl.textContent = movie.vote_count ?? 0;\n\n  //  Popülerlik değeri\n  if (popularityEl) {\n    const roundedPop = roundOneDecimal(movie.popularity ?? 0);\n    popularityEl.textContent = roundedPop.toFixed(1);\n  }\n\n  //  Tür bilgisi\n  if (genreEl) {\n    let genreText = '-';\n    if (Array.isArray(movie.genres) && movie.genres.length > 0) {\n      genreText = movie.genres\n        .map(g => g.name)\n        .slice(0, 3)\n        .join(', ');\n    } else if (movie.genre_ids && Array.isArray(movie.genre_ids)) {\n      genreText = movie.genre_ids.join(', ');\n    }\n    genreEl.textContent = genreText;\n  }\n\n  // Film özeti (about)\n  if (aboutEl) {\n    aboutEl.textContent =\n      movie.overview || movie.description || 'No description available.';\n  }\n\n  // Library butonunu güncelle\n  updateLibraryButton(movie.id);\n};\n\n// Library Buton Tıklaması\n\nif (libraryBtn) {\n  libraryBtn.addEventListener('click', async e => {\n    e.preventDefault();\n\n    const movieId =\n      libraryBtn.dataset.movieId || (currentMovieData && currentMovieData.id);\n    if (!movieId) return;\n\n    const inLib = isInLibrary(movieId);\n\n    // Eğer film zaten kütüphanedeyse kaldır\n    if (inLib) {\n      removeFromLibrary(movieId);\n      updateLibraryButton(movieId);\n      return;\n    }\n\n    // Eğer film detayları eksikse API'den çek\n    let movie = currentMovieData;\n    if (!movie || String(movieId) !== String(movie.id)) {\n      try {\n        movie = await fetchMovieDetails(movieId);\n      } catch (error) {\n        console.error('fetchMovieDetails fonksiyonu hatası:', error);\n        return;\n      }\n    }\n\n    // Kaydedilecek film objesini hazırlama\n    const toStore = {\n      id: movie.id,\n      title: movie.title || movie.name || '',\n      poster_path: movie.poster_path || '',\n      vote_average: movie.vote_average ?? 0,\n      vote_count: movie.vote_count ?? 0,\n      popularity: movie.popularity ?? 0,\n      genres: movie.genres ?? movie.genre_ids ?? [],\n      overview: movie.overview || '',\n      savedAt: new Date().toISOString(),\n    };\n\n    // Local Storage’a ekle ve butonu güncelle\n    addToLibrary(toStore);\n    updateLibraryButton(movieId);\n  });\n}\n"],"names":["LOCAL_STORAGE_KEY","IMAGE_BASE","roundOneDecimal","value","n","readLibraryFromStorage","raw","error","writeLibraryToStorage","obj","isInLibrary","movieId","addToLibrary","movieObj","lib","removeFromLibrary","buildImageUrl","path","modalEl","closeBtnEl","posterImgEl","titleEl","votesPuanEl","votesCountEl","popularityEl","genreEl","aboutEl","libraryBtn","escHandler","backdropHandler","currentMovieData","openModal","closeModal","updateLibraryButton","inLib","renderMovieInModal","movie","posterPath","posterUrl","rounded","roundedPop","genreText","g","fetchMovieDetails","toStore"],"mappings":"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"}