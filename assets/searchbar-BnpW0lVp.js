import{e as P,s as A}from"./api-W8kOuucx.js";let l={isSearching:!1,query:"",year:"",currentPage:1};function L(){const t=document.getElementById("catalog-search-form");if(!t)return;const n=document.getElementById("catalog-search-input"),r=document.getElementById("catalog-search-clear"),a=document.getElementById("catalog-search-alert"),y=document.getElementById("yearFilter"),i=document.getElementById("yearBtn"),s=document.getElementById("yearList");b(s);const g=()=>{const e=!!n.value.trim();t.classList.toggle("has-query",e),r&&(r.hidden=!e),e||w("")};n.addEventListener("input",g),g(),r==null||r.addEventListener("click",()=>{n.value="",g(),S(a),n.focus()}),t.addEventListener("submit",async e=>{e.preventDefault();const o=n.value.trim(),c=p();if(!o&&!c){S(a);return}await k(o,c,a,1)}),i.addEventListener("click",e=>{e.stopPropagation(),d(s.hidden)}),s.addEventListener("click",e=>{const o=e.target.closest(".year-option");if(!o)return;w(o.dataset.value),d(!1);const c=n.value.trim(),f=p();(c||f)&&k(c,f,a,1)}),i.addEventListener("keydown",e=>{(e.key==="ArrowDown"||e.key==="Enter"||e.key===" ")&&(e.preventDefault(),d(!0),B())}),s.addEventListener("keydown",e=>{var f,v,E;const o=[...s.querySelectorAll(".year-option")],c=o.indexOf(document.activeElement);e.key==="Escape"&&d(!1),e.key==="ArrowDown"&&(e.preventDefault(),(f=o[Math.min(c+1,o.length-1)])==null||f.focus()),e.key==="ArrowUp"&&(e.preventDefault(),(v=o[Math.max(c-1,0)])==null||v.focus()),e.key==="Enter"&&(e.preventDefault(),(E=document.activeElement)==null||E.click()),e.key==="Tab"&&d(!1)}),document.addEventListener("click",e=>{y.contains(e.target)||d(!1)});function d(e){(e===void 0?s.hidden:!!e)?(s.hidden=!1,i.setAttribute("aria-expanded","true"),s.focus()):(s.hidden=!0,i.setAttribute("aria-expanded","false"))}function B(){const e=s.querySelector('.year-option[aria-selected="true"]')||s.querySelector(".year-option");e==null||e.focus()}function w(e){i.dataset.value=e||"",i.firstChild.nodeValue=e||"Year",s.querySelectorAll(".year-option").forEach(o=>{o.setAttribute("aria-selected",o.dataset.value===e?"true":"false")})}function p(){return i.dataset.value||""}}async function x(t){var n;if(!l.isSearching)return!1;try{h();const r=await A(l.query,l.year,t);return window.renderMoviesList&&window.renderMoviesList(r.results||[]),window.renderPagination&&window.renderPagination(t,r.total_pages||1),l.currentPage=t,window.scrollTo({top:0,behavior:"smooth"}),u(((n=r==null?void 0:r.results)!=null&&n.length,"")),!0}catch(r){return console.error("Sayfa değiştirme hatası:",r),u("An error occurred while loading the page."),!1}finally{m()}}async function S(t){l={isSearching:!1,query:"",year:"",currentPage:1};try{h();const n=await P(1);window.renderMoviesList&&window.renderMoviesList(n.results||[]),window.renderPagination&&window.renderPagination(1,n.total_pages||1),u("",t)}catch(n){console.error("Temizleme hatası:",n),u("Failed to load movies.",t)}finally{m()}}async function k(t,n,r,a=1){var y;l={isSearching:!0,query:t,year:n,currentPage:a};try{h();const i=await A(t,n,a);window.renderMoviesList&&window.renderMoviesList(i.results||[]),window.renderPagination&&window.renderPagination(a,i.total_pages||1),u(((y=i==null?void 0:i.results)!=null&&y.length,""),r)}catch(i){console.error("Arama hatası:",i),u("Search failed. Please try again.",r)}finally{m()}}function b(t){if(!t||t.childElementCount)return;const n=new Date().getFullYear();for(let r=n;r>=1950;r--){const a=document.createElement("li");a.className="year-option",a.setAttribute("role","option"),a.setAttribute("tabindex","-1"),a.dataset.value=String(r),a.textContent=String(r),t.appendChild(a)}}function h(){const t=document.getElementById("loading-indicator");t&&(t.style.display="flex")}function m(){const t=document.getElementById("loading-indicator");t&&(t.style.display="none")}function u(t,n=document.getElementById("catalog-search-alert")){n&&(n.textContent=t||"",n.style.display=t?"block":"none")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):L();export{S as handleClear,x as handleSearchPageChange,L as initSearchBar};
//# sourceMappingURL=searchbar-BnpW0lVp.js.map
