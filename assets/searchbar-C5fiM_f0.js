import{e as P,s as A}from"./api-W8kOuucx.js";let u={isSearching:!1,query:"",year:"",currentPage:1};function L(){const t=document.getElementById("catalog-search-form");if(!t)return;const n=document.getElementById("catalog-search-input"),r=document.getElementById("catalog-search-clear"),a=document.getElementById("catalog-search-alert"),s=document.getElementById("yearFilter"),d=document.getElementById("yearBtn"),o=document.getElementById("yearList");b(o);const g=()=>{const e=!!n.value.trim();t.classList.toggle("has-query",e),r&&(r.hidden=!e),e||w("")};n.addEventListener("input",g),g(),r==null||r.addEventListener("click",()=>{n.value="",g(),S(a),n.focus()}),t.addEventListener("submit",async e=>{e.preventDefault();const i=n.value.trim(),c=p();if(!i&&!c){S(a);return}await k(i,c,a)}),d.addEventListener("click",e=>{e.stopPropagation(),l(o.hidden)}),o.addEventListener("click",e=>{const i=e.target.closest(".year-option");if(!i)return;w(i.dataset.value),l(!1);const c=n.value.trim(),y=p();(c||y)&&k(c,y,a)}),d.addEventListener("keydown",e=>{(e.key==="ArrowDown"||e.key==="Enter"||e.key===" ")&&(e.preventDefault(),l(!0),B())}),o.addEventListener("keydown",e=>{var y,v,E;const i=[...o.querySelectorAll(".year-option")],c=i.indexOf(document.activeElement);e.key==="Escape"&&l(!1),e.key==="ArrowDown"&&(e.preventDefault(),(y=i[Math.min(c+1,i.length-1)])==null||y.focus()),e.key==="ArrowUp"&&(e.preventDefault(),(v=i[Math.max(c-1,0)])==null||v.focus()),e.key==="Enter"&&(e.preventDefault(),(E=document.activeElement)==null||E.click()),e.key==="Tab"&&l(!1)}),document.addEventListener("click",e=>{s.contains(e.target)||l(!1)});function l(e){(e===void 0?o.hidden:!!e)?(o.hidden=!1,d.setAttribute("aria-expanded","true"),o.focus()):(o.hidden=!0,d.setAttribute("aria-expanded","false"))}function B(){const e=o.querySelector('.year-option[aria-selected="true"]')||o.querySelector(".year-option");e==null||e.focus()}function w(e){d.dataset.value=e||"",d.firstChild.nodeValue=e||"Year",o.querySelectorAll(".year-option").forEach(i=>{i.setAttribute("aria-selected",i.dataset.value===e?"true":"false")})}function p(){return d.dataset.value||""}}async function x(t){var n;if(!u.isSearching)return!1;try{h();const r=await A(u.query,t,u.year);return window.renderMoviesList&&window.renderMoviesList(r.results||[]),window.renderPagination&&window.renderPagination(t,r.total_pages||1),u.currentPage=t,window.scrollTo({top:0,behavior:"smooth"}),f(((n=r==null?void 0:r.results)!=null&&n.length,"")),!0}catch(r){return console.error("Sayfa değiştirme hatası:",r),f("An error occurred while loading the page."),!1}finally{m()}}async function S(t){u={isSearching:!1,query:"",year:"",currentPage:1};try{h();const n=await P(1);window.renderMoviesList&&window.renderMoviesList(n.results||[]),window.renderPagination&&window.renderPagination(1,n.total_pages||1),f("",t)}catch(n){console.error("Temizleme hatası:",n),f("Failed to load movies.",t)}finally{m()}}async function k(t,n,r){var a;u={isSearching:!0,query:t,year:n,currentPage:1};try{h();const s=await A(t,1,n);window.renderMoviesList&&window.renderMoviesList(s.results||[]),window.renderPagination&&window.renderPagination(1,s.total_pages||1),f(((a=s==null?void 0:s.results)!=null&&a.length,""),r)}catch(s){console.error("Arama hatası:",s),f("Search failed. Please try again.",r)}finally{m()}}function b(t){if(!t||t.childElementCount)return;const n=new Date().getFullYear();for(let r=n;r>=1950;r--){const a=document.createElement("li");a.className="year-option",a.setAttribute("role","option"),a.setAttribute("tabindex","-1"),a.dataset.value=String(r),a.textContent=String(r),t.appendChild(a)}}function h(){const t=document.getElementById("loading-indicator");t&&(t.style.display="flex")}function m(){const t=document.getElementById("loading-indicator");t&&(t.style.display="none")}function f(t,n=document.getElementById("catalog-search-alert")){n&&(n.textContent=t||"",n.style.display=t?"block":"none")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):L();export{S as handleClear,x as handleSearchPageChange,L as initSearchBar};
//# sourceMappingURL=searchbar-C5fiM_f0.js.map
