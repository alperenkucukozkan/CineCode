{"version":3,"file":"searchbar-C5fiM_f0.js","sources":["../../src/js/searchbar.js"],"sourcesContent":["import * as API from '../api/api.js';\n\nlet currentSearchState = {\n  isSearching: false,\n  query: '',\n  year: '',\n  currentPage: 1,\n};\n\nexport function initSearchBar() {\n  const form  = document.getElementById('catalog-search-form');\n  if (!form) return;\n\n  const input   = document.getElementById('catalog-search-input');\n  const clear   = document.getElementById('catalog-search-clear');\n  const alertEl = document.getElementById('catalog-search-alert');\n\n  const yearWrap = document.getElementById('yearFilter');\n  const yearBtn  = document.getElementById('yearBtn');\n  const yearList = document.getElementById('yearList');\n\n  buildYearList(yearList);\n\n  const setHasQuery = () => {\n    const has = !!input.value.trim();\n    form.classList.toggle('has-query', has);\n    if (clear) clear.hidden = !has;\n    if (!has) setYear(''); \n  };\n  input.addEventListener('input', setHasQuery);\n  setHasQuery();\n\n  clear?.addEventListener('click', () => {\n    input.value = '';\n    setHasQuery();\n    handleClear(alertEl);\n    input.focus();\n  });\n\n  form.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const q = input.value.trim();\n    const y = getYear();\n    if (!q && !y) { handleClear(alertEl); return; }\n    await handleSearch(q, y, alertEl);\n  });\n\n  yearBtn.addEventListener('click', (e) => {\n    e.stopPropagation();\n    toggleYearMenu(yearList.hidden); // aç/kapat\n  });\n\n  yearList.addEventListener('click', (e) => {\n    const li = e.target.closest('.year-option');\n    if (!li) return;\n    setYear(li.dataset.value);\n    toggleYearMenu(false);\n    const q = input.value.trim();\n    const y = getYear();\n    if (q || y) handleSearch(q, y, alertEl);\n  });\n\n  // Klavye\n  yearBtn.addEventListener('keydown', (e) => {\n    if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      toggleYearMenu(true);\n      focusFirstYear();\n    }\n  });\n  yearList.addEventListener('keydown', (e) => {\n    const items = [...yearList.querySelectorAll('.year-option')];\n    const idx = items.indexOf(document.activeElement);\n    if (e.key === 'Escape') toggleYearMenu(false);\n    if (e.key === 'ArrowDown') { e.preventDefault(); items[Math.min(idx+1, items.length-1)]?.focus(); }\n    if (e.key === 'ArrowUp')   { e.preventDefault(); items[Math.max(idx-1, 0)]?.focus(); }\n    if (e.key === 'Enter')     { e.preventDefault(); document.activeElement?.click(); }\n    if (e.key === 'Tab')       { toggleYearMenu(false); }\n  });\n\n  document.addEventListener('click', (e) => {\n    if (!yearWrap.contains(e.target)) toggleYearMenu(false);\n  });\n\n  function toggleYearMenu(open){\n    const willOpen = open === undefined ? yearList.hidden : !!open;\n    if (willOpen) {\n      yearList.hidden = false;\n      yearBtn.setAttribute('aria-expanded', 'true');\n      yearList.focus();\n    } else {\n      yearList.hidden = true;\n      yearBtn.setAttribute('aria-expanded', 'false');\n    }\n  }\n  function focusFirstYear(){\n    const sel = yearList.querySelector('.year-option[aria-selected=\"true\"]') ||\n                yearList.querySelector('.year-option');\n    sel?.focus();\n  }\n  function setYear(val){\n    yearBtn.dataset.value = val || '';\n    yearBtn.firstChild.nodeValue = val ? val : 'Year';\n    yearList.querySelectorAll('.year-option').forEach(li => {\n      li.setAttribute('aria-selected', li.dataset.value === val ? 'true' : 'false');\n    });\n  }\n  function getYear(){ return yearBtn.dataset.value || ''; }\n}\n\nexport async function handleSearchPageChange(page) {\n  if (!currentSearchState.isSearching) return false;\n\n  try {\n    showLoader();\n    const data = await API.searchMovies(\n      currentSearchState.query,\n      page,\n      currentSearchState.year\n    );\n\n    if (window.renderMoviesList) window.renderMoviesList(data.results || []);\n    if (window.renderPagination) window.renderPagination(page, data.total_pages || 1);\n\n    currentSearchState.currentPage = page;\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n\n    setAlert(data?.results?.length ? '' : '');\n    return true;\n  } catch (err) {\n    console.error('Sayfa değiştirme hatası:', err);\n    setAlert('An error occurred while loading the page.');\n    return false;\n  } finally {\n    hideLoader();\n  }\n}\n\nexport async function handleClear(alertEl) {\n  currentSearchState = { isSearching: false, query: '', year: '', currentPage: 1 };\n  try {\n    showLoader();\n    const data = await API.fetchTrendingWeek(1);\n    if (window.renderMoviesList) window.renderMoviesList(data.results || []);\n    if (window.renderPagination) window.renderPagination(1, data.total_pages || 1);\n    setAlert('', alertEl);\n  } catch (err) {\n    console.error('Temizleme hatası:', err);\n    setAlert('Failed to load movies.', alertEl);\n  } finally {\n    hideLoader();\n  }\n}\n\nasync function handleSearch(query, year, alertEl) {\n  currentSearchState = { isSearching: true, query, year, currentPage: 1 };\n  try {\n    showLoader();\n    const data = await API.searchMovies(query, 1, year); // (query,page,year)\n    if (window.renderMoviesList) window.renderMoviesList(data.results || []);\n    if (window.renderPagination) window.renderPagination(1, data.total_pages || 1);\n    setAlert(data?.results?.length ? '' : '', alertEl);\n  } catch (err) {\n    console.error('Arama hatası:', err);\n    setAlert('Search failed. Please try again.', alertEl);\n  } finally {\n    hideLoader();\n  }\n}\n\nfunction buildYearList(ul){\n  if (!ul || ul.childElementCount) return;\n  const now = new Date().getFullYear();\n  for (let y = now; y >= 1950; y--){\n    const li = document.createElement('li');\n    li.className = 'year-option';\n    li.setAttribute('role', 'option');\n    li.setAttribute('tabindex', '-1');\n    li.dataset.value = String(y);\n    li.textContent = String(y);\n    ul.appendChild(li);\n  }\n}\n\nfunction showLoader() {\n  const loader = document.getElementById('loading-indicator');\n  if (loader) loader.style.display = 'flex';\n}\nfunction hideLoader() {\n  const loader = document.getElementById('loading-indicator');\n  if (loader) loader.style.display = 'none';\n}\nfunction setAlert(msg, el = document.getElementById('catalog-search-alert')) {\n  if (!el) return;\n  el.textContent = msg || '';\n  el.style.display = msg ? 'block' : 'none';\n}\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initSearchBar);\n} else {\n  initSearchBar();\n}\n"],"names":["currentSearchState","initSearchBar","form","input","clear","alertEl","yearWrap","yearBtn","yearList","buildYearList","setHasQuery","has","setYear","handleClear","q","y","getYear","handleSearch","toggleYearMenu","li","focusFirstYear","items","idx","_a","_b","_c","open","sel","val","handleSearchPageChange","page","showLoader","data","API.searchMovies","setAlert","err","hideLoader","API.fetchTrendingWeek","query","year","ul","now","loader","msg","el"],"mappings":"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"}