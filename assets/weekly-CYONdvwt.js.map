{"version":3,"file":"weekly-CYONdvwt.js","sources":["../../src/js/weekly.js"],"sourcesContent":["import {\n  fetchWeeklyMovies,\n  fetchGenres,\n  fetchMovieDetails,\n} from '../api/api.js';\nimport * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\nlet gallery;\nlet seeAllBtn;\nlet allMovies = [];\nlet isExpanded = false;\nfunction getVisibleCardCount() {\n  const width = window.innerWidth;\n  if (width < 768) return 1;\n  if (width < 1280) return 3;\n  return 3;\n}\nfunction createRatingStars(vote) {\n  const fullStars = Math.floor(vote / 2);\n  const hasHalfStar = vote % 2 >= 1;\n  const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);\n  let stars = [];\n  for (let i = 0; i < fullStars; i++)\n    stars.push(\n      '<svg class=\"icon-full-star\"><use xlink:href=\"../img/icon.svg#icon-full-star\"></use></svg>'\n    );\n  if (hasHalfStar)\n    stars.push(\n      '<svg class=\"icon-half-star\"><use xlink:href=\"../img/icon.svg#icon-half-star\"></use></svg>'\n    );\n  for (let i = 0; i < emptyStars; i++)\n    stars.push(\n      '<svg class=\"icon-empty-star\"><use xlink:href=\"../img/icon.svg#icon-empty-star\"></use></svg>'\n    );\n  return stars.join('');\n}\nfunction toggleLibraryButton(movie, button) {\n  let library = JSON.parse(localStorage.getItem('library')) || [];\n  const isInLibrary = library.some(\n    item => Number(item.id) === Number(movie.id)\n  );\n  if (isInLibrary) {\n    library = library.filter(item => Number(item.id) !== Number(movie.id));\n    button.textContent = 'Add to Library';\n    button.classList.remove('remove-from-library');\n    button.classList.add('library-btn-w');\n  } else {\n    if (!movie.genre_ids && movie.genres) {\n      movie.genre_ids = movie.genres.map(g => g.id);\n    }\n    library.push(movie);\n    button.textContent = 'Remove from my library';\n    button.classList.remove('library-btn-w');\n    button.classList.add('remove-from-library');\n  }\n  localStorage.setItem('library', JSON.stringify(library));\n}\nasync function renderWeeklyTrends(limit = getVisibleCardCount()) {\n  try {\n    const [trendData, genreData] = await Promise.all([\n      fetchWeeklyMovies(),\n      fetchGenres(),\n    ]);\n    allMovies = trendData.results;\n    const genreMap = genreData.genres.reduce((acc, genre) => {\n      acc[genre.id] = genre.name;\n      return acc;\n    }, {});\n    const moviesToShow = allMovies.slice(0, limit);\n    const markup = moviesToShow\n      .map(movie => {\n        const posterUrl = movie.poster_path\n          ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`\n          : `https://via.placeholder.com/500x750?text=No+Image`;\n        const genreName = movie.genre_ids\n          .map(id => genreMap[id])\n          .slice(0, 1)\n          .join(', ');\n        const year = movie.release_date\n          ? movie.release_date.slice(0, 4)\n          : 'N/A';\n        const ratingStars = createRatingStars(movie.vote_average);\n        return `\n          <li class=\"weekly-card\" data-id=\"${movie.id}\">\n            <div class=\"poster-wrapper\">\n              <img class=\"card-img\" src=\"${posterUrl}\" alt=\"${movie.title}\" />\n              <div class=\"card-overlay\">\n                <h3 class=\"card-title\">${movie.title.toUpperCase()}</h3>\n                <p class=\"card-info\">${genreName} | ${year}</p>\n                <div class=\"card-rating\">${ratingStars}</div>\n              </div>\n            </div>\n          </li>\n        `;\n      })\n      .join('');\n    gallery.innerHTML = markup;\n  } catch (err) {\n    console.error('Weekly trends fetch error:', err);\n    gallery.innerHTML = '<p>Veriler alınamadı.</p>';\n  }\n}\nfunction initWeeklySection() {\n  gallery = document.querySelector('.weekly-gallery');\n  seeAllBtn = document.querySelector('.see-all');\n  if (!gallery || !seeAllBtn) {\n    console.warn('weekly-gallery veya see-all bulunamadı.');\n    return;\n  }\n  // See all butonu\n  seeAllBtn.addEventListener('click', () => {\n    isExpanded = !isExpanded;\n    const count = isExpanded ? allMovies.length : getVisibleCardCount();\n    renderWeeklyTrends(count);\n  });\n  // Kart tıklanmasıyla modal açma\n  gallery.addEventListener('click', async e => {\n    const card = e.target.closest('.weekly-card');\n    if (!card) return;\n    const movieId = card.dataset.id;\n    try {\n      const movie = await fetchMovieDetails(movieId);\n      const posterUrl = movie.poster_path\n        ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`\n        : `https://via.placeholder.com/500x750?text=No+Image`;\n      const genres = movie.genres.map(g => g.name).join(', ');\n      const library = JSON.parse(localStorage.getItem('library')) || [];\n      const inLibrary = library.some(\n        item => Number(item.id) === Number(movie.id)\n      );\n      const popup = basicLightbox.create(\n        `\n        <div class=\"weekly-movie-modal\">\n          <button class=\"popup-close-btn\" aria-label=\"Close\">\n            <svg class=\"icon-close\" width=\"24\" height=\"24\">\n              <use xlink:href=\"../../img/icon.svg#icon-close\"></use>\n            </svg>\n          </button>\n          <img src=\"${posterUrl}\" class=\"modal-poster\" alt=\"${movie.title}\">\n          <div class=\"modal-details\">\n            <h2>${movie.title}</h2>\n            <p><strong>Vote / Votes:</strong> ${movie.vote_average} / ${\n          movie.vote_count\n        }</p>\n            <p><strong>Popularity:</strong> ${movie.popularity}</p>\n            <p><strong>Genre:</strong> ${genres}</p>\n            <h3>ABOUT</h3>\n            <p>${movie.overview}</p>\n            <button class=\"${\n              inLibrary ? 'remove-from-library' : 'library-btn-w'\n            }\">\n              ${inLibrary ? 'Remove from my library' : 'Add to Library'}\n            </button>\n          </div>\n        </div>\n        `,\n        {\n          onShow: instance => {\n            const closeBtn = instance\n              .element()\n              .querySelector('.popup-close-btn');\n            closeBtn.addEventListener('click', () => instance.close());\n            const addBtn = instance\n              .element()\n              .querySelector(\n                'button.remove-from-library, button.library-btn-w'\n              );\n            addBtn.addEventListener('click', () =>\n              toggleLibraryButton(movie, addBtn)\n            );\n          },\n        }\n      );\n      popup.show();\n      function handleEscKey(e) {\n        if (e.key === 'Escape') {\n          popup.close();\n          window.removeEventListener('keydown', handleEscKey);\n        }\n      }\n      window.addEventListener('keydown', handleEscKey);\n    } catch (err) {\n      console.error('Popup açılırken hata:', err);\n    }\n  });\n  renderWeeklyTrends();\n}\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initWeeklySection, {\n    once: true,\n  });\n} else {\n  initWeeklySection();\n}\n"],"names":["gallery","seeAllBtn","allMovies","isExpanded","getVisibleCardCount","width","createRatingStars","vote","fullStars","hasHalfStar","emptyStars","stars","i","toggleLibraryButton","movie","button","library","item","g","renderWeeklyTrends","limit","trendData","genreData","fetchWeeklyMovies","fetchGenres","genreMap","acc","genre","markup","posterUrl","genreName","id","year","ratingStars","err","initWeeklySection","count","card","movieId","handleEscKey","e","popup","fetchMovieDetails","genres","inLibrary","basicLightbox.create","instance","addBtn"],"mappings":"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"}